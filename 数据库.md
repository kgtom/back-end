# 学习大纲

## 一、事务
1. 概念
2. ACID
3. AUTOCOMMIT

## 二、并发一致性问题
1. 丢失修改
2. 读脏数据
3. 不可重复读
4. 幻影读

## 三、封锁
1. 封锁粒度
2. 封锁类型
3. 封锁协议
4. MySQL 隐式与显示锁定

## 四、慢查询问题(sql索引)

### 分析
* 1.去掉cache 查询
* 2.单表字段区分度
* 3.业务场景优化
* 4.explain建立索引

### 索引建立原则
* 最左匹配，注意顺序
* 检查区分度高低
* 字段不包含计算，因为b+是字段值
* 尽量索引扩展，而非新建
### 索引demo

#### 1.后缀的模糊like查询 xxx%,使用b-tree或者reverse索引
运算符：text_pattern_ops, varchar_pattern_ops, bpchar_pattern_ops

**创建索引:**
~~~
CREATE INDEX tsl_ticket_num_like_back_idx ON tsl (UPPER (ticket_num) text_pattern_ops ); 
或者
create index tsl_ticket_num_pre_idx on tsl(reverse(ticket_num) varchar_pattern_ops); 
~~~
**sql:**
~~~
explain (analyze,verbose,timing,costs,buffers) SELECT
	* 
FROM
	"tsl" 
WHERE
	reverse (upper(ticket_num)) LIKE'081-2761367%' 
	LIMIT 15
~~~


#### 2.前后模糊like查询，%xxx%,使用pg_trgm

**创建索引:**
~~~
create extension pg_trgm; 
create index tsl_ticket_num_like_2_idx on tsl using gin (UPPER (ticket_num) gin_trgm_ops);      

~~~
**sql:**
~~~
EXPLAIN ( ANALYZE, VERBOSE, timing, costs, buffers ) SELECT
* 
FROM
	"tsl" 
WHERE
	UPPER ( ticket_num ) LIKE'%081-2761367%' 
	LIMIT 15 
~~~

## 五、

> reference:
* [官方文档](http://www.postgres.cn/docs/9.6/indexes-opclass.html)
* [官方中文文档](https://www.yiibai.com/manual/postgresql/indexes-opclass.html)


